/*! Lazy Load 1.9.5 - MIT license - Copyright 2010-2015 Mika Tuupola */
!function(a,b,c,d){var e=a(b);a.fn.lazyload=function(f){function g(){var b=0;i.each(function(){var c=a(this);if(!j.skip_invisible||c.is(":visible"))if(a.abovethetop(this,j)||a.leftofbegin(this,j));else if(a.belowthefold(this,j)||a.rightoffold(this,j)){if(++b>j.failure_limit)return!1}else c.trigger("appear"),b=0})}var h,i=this,j={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:b,data_attribute:"original",skip_invisible:!1,appear:null,load:null,placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"};return f&&(d!==f.failurelimit&&(f.failure_limit=f.failurelimit,delete f.failurelimit),d!==f.effectspeed&&(f.effect_speed=f.effectspeed,delete f.effectspeed),a.extend(j,f)),h=j.container===d||j.container===b?e:a(j.container),0===j.event.indexOf("scroll")&&h.bind(j.event,function(){return g()}),this.each(function(){var b=this,c=a(b);b.loaded=!1,(c.attr("src")===d||c.attr("src")===!1)&&c.is("img")&&c.attr("src",j.placeholder),c.one("appear",function(){if(!this.loaded){if(j.appear){var d=i.length;j.appear.call(b,d,j)}a("<img />").bind("load",function(){var d=c.attr("data-"+j.data_attribute);c.hide(),c.is("img")?c.attr("src",d):c.css("background-image","url('"+d+"')"),c[j.effect](j.effect_speed),b.loaded=!0;var e=a.grep(i,function(a){return!a.loaded});if(i=a(e),j.load){var f=i.length;j.load.call(b,f,j)}}).attr("src",c.attr("data-"+j.data_attribute))}}),0!==j.event.indexOf("scroll")&&c.bind(j.event,function(){b.loaded||c.trigger("appear")})}),e.bind("resize",function(){g()}),/(?:iphone|ipod|ipad).*os 5/gi.test(navigator.appVersion)&&e.bind("pageshow",function(b){b.originalEvent&&b.originalEvent.persisted&&i.each(function(){a(this).trigger("appear")})}),a(c).ready(function(){g()}),this},a.belowthefold=function(c,f){var g;return g=f.container===d||f.container===b?(b.innerHeight?b.innerHeight:e.height())+e.scrollTop():a(f.container).offset().top+a(f.container).height(),g<=a(c).offset().top-f.threshold},a.rightoffold=function(c,f){var g;return g=f.container===d||f.container===b?e.width()+e.scrollLeft():a(f.container).offset().left+a(f.container).width(),g<=a(c).offset().left-f.threshold},a.abovethetop=function(c,f){var g;return g=f.container===d||f.container===b?e.scrollTop():a(f.container).offset().top,g>=a(c).offset().top+f.threshold+a(c).height()},a.leftofbegin=function(c,f){var g;return g=f.container===d||f.container===b?e.scrollLeft():a(f.container).offset().left,g>=a(c).offset().left+f.threshold+a(c).width()},a.inviewport=function(b,c){return!(a.rightoffold(b,c)||a.leftofbegin(b,c)||a.belowthefold(b,c)||a.abovethetop(b,c))},a.extend(a.expr[":"],{"below-the-fold":function(b){return a.belowthefold(b,{threshold:0})},"above-the-top":function(b){return!a.belowthefold(b,{threshold:0})},"right-of-screen":function(b){return a.rightoffold(b,{threshold:0})},"left-of-screen":function(b){return!a.rightoffold(b,{threshold:0})},"in-viewport":function(b){return a.inviewport(b,{threshold:0})},"above-the-fold":function(b){return!a.belowthefold(b,{threshold:0})},"right-of-fold":function(b){return a.rightoffold(b,{threshold:0})},"left-of-fold":function(b){return!a.rightoffold(b,{threshold:0})}})}(jQuery,window,document);
/*! 
 * dmeng base (http://www.kernel.net) 
 * 7:58 2015/9/21
 * @author steven.chan.chihyu(http://duomeng.me)
 */
kernel.user = {}; !
function($) {
    var $document = $(document),
    $window = $(window);
    kernel.lazyload = function() {
        $(".entry-thumbnail img, img.avatar, img.look").lazyload({
            effect: "show"
        });
        $("#sidebar img.avatar,#sidebar img.look").lazyload({
            effect: "show"
        })
    };
    kernel.hashOffset = function(h) {
        var h = h ? h: location.hash,
        $h = $(h);
        if ($(h).length <= 0) {
            return null
        }
        var st = $(h).offset().top;
        if (!kernel.is_mobile) {
            st = st - parseInt($("#masthead .navbar").outerHeight(true))
        }
        return st
    };
    kernel.goHash = function(h) {
        var st = kernel.hashOffset(h);
        if (null !== st) {
            $("html,body").animate({
                scrollTop: st
            },
            800)
        }
    };
    kernel.setCookie = function(c_name, value, expire, path) {
        var exdate = new Date();
        exdate.setTime(exdate.getTime() + expire * 1000);
        document.cookie = c_name + "=" + escape(value) + ((expire == null) ? "": ";expires=" + exdate.toGMTString()) + ((path == null) ? "": ";path=" + path)
    };
    kernel.getCookie = function(c_name) {
        if (document.cookie.length > 0) {
            var c_start = document.cookie.indexOf(c_name + "=");
            if (c_start != -1) {
                c_start = c_start + c_name.length + 1;
                var c_end = document.cookie.indexOf(";", c_start);
                if (c_end == -1) {
                    c_end = document.cookie.length
                }
                return unescape(document.cookie.substring(c_start, c_end))
            }
        }
        return ""
    };
    kernel.getQueryString = function(key) {
        var reg = new RegExp("(^|&)" + key + "=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) {
            return unescape(r[2])
        }
        return null
    };
    kernel.updateQueryString = function(uri, key, value) {
        var reg = new RegExp("([?&])" + key + "=.*?(&|$)", "i");
        var sep = uri.indexOf("?") !== -1 ? "&": "?";
        if (uri.match(reg)) {
            return uri.replace(reg, "$1" + key + "=" + value + "$2")
        }
        return uri + sep + key + "=" + value
    };
    kernel.htmlEncode = function(value) {
        return $("<div/>").text(value).html()
    };
    kernel.htmlDecode = function(value) {
        return $("<div/>").html(value).text()
    };
    kernel.numberFormat = function(number) {
        var n = parseInt(number.toString().replace(",", "")),
        prefix = "kMGTPEZY";
        if (n < 100000) {
            return number
        }
        for (var i = -1; n >= 1000; i++) {
            n /= 1000
        }
        return Math.floor(n) + prefix.charAt(i) + "+"
    };
    kernel.pageUrl = location.href;
    /*评论加载处理*/
    kernel.commentsLoading = 0;
    kernel.commentsID = "#comments";
    kernel.commentsThread = "#thread-comments";
    kernel.commentsLoadID = "#comments-loading";
    kernel.commentsLoad = function(paged) {
        if (kernel.commentsLoading) {
            return
        }
        if ($(kernel.commentsLoadID).length > 0 && $(kernel.commentsLoadID).hasClass("loaded") == false && ($(kernel.commentsLoadID).offset().top - $window.height() - $window.scrollTop()) <= 0) {
            kernel.commentsLoading = 1;
            //默认传入的是分页参数
            var requestUrl = kernel.commentListUrl;
            var requestData = {
                page: (paged ? paged: kernel.page),
            };
            //如果传入的是链接
            if(paged && isNaN(parseInt(paged))){
                requestUrl = paged;
                requestData = {};
            }
            $.get(requestUrl, requestData, function(data) {
                $(kernel.commentsID).after($(kernel.commentsLoadID).addClass("loaded").hide()).append(data);
                kernel.commentsLoading = 0;
                kernel.initVote();
                kernel.lazyload();
                if (window.location.hash.indexOf("#comment") === 0) {
                    kernel.goHash()
                }
            })
        }
    };
    window.addComment = {
        moveForm: function(comment, parent, respond, post) {
            var c = "#" + comment;
            var l = $("#commentform .help-block a");
            if ($(c).next("form").length > 0) {
                $(c).find(".comment-reply-link").removeClass("highlight");
                $("#parent_id").val("0");
                $("#" + respond).append($("#commentform"));
                kernel.isReply = 0
            } else {
                $(".comment-reply-link").removeClass("highlight");
                $(c).find(".comment-reply-link").addClass("highlight");
                $("#parent_id").val(parent);
                $(c).after($("#commentform"));
                kernel.goHash("#" + comment);
                kernel.isReply = 1
            }
            return false
        }
    };
    kernel.vote = function(t, i, v, e) {
        var voteUrl = t == 'post' ? kernel.postVoteUrl : kernel.commentVoteUrl;
        voteUrl = v == 'praise' ? voteUrl.like : voteUrl.unlike;
        e.parent().addClass("disabled").children().addClass("disabled");
        $.ajax({
            type: "post",
            url: voteUrl,
            success: function(response){
                if(response.code == 0) {
                    e.parent().removeClass("disabled").children().removeClass("disabled");
                    var cookieTime, vote;
                    e.addClass("active disabled").siblings().addClass("disabled").parent().addClass("disabled");
                    cookieTime = 3600 * 24
                    e.blur().children(".num").html(v == 'praise' ? response.info.vote.praise_nums : response.info.vote.stamp_nums);
                    kernel.setCookie("vote_" + t + "_" + i, v, cookieTime, "/")
                }
            },
            dataType: 'json'
        });
        return false;
    };
    kernel.initVote = function() {
        $(".vote-group").each(function() {
            if ($(this).hasClass("disabled")) {
                return
            }
            var i = $(this).attr("data-vote-id"),
            t = $.trim($(this).attr("data-vote-type")) == "post" ? "post": "comment",
            c = kernel.getCookie("vote_" + t + "_" + i);
            if (c != null && (c == "praise" || c == "stamp")) {
                c = c == "praise" ? 'up' : 'down';
                $(this).addClass("disabled");
                $(this).children("." + c).addClass("active disabled").siblings().addClass("disabled")
            }
        });
    };
    kernel.initUser = function(data){
        if(data.user){
            kernel.user = data.user;
            var float_menu_id = "#float-nav-menu",
            uc_id = "#ucenterAvatar",
            hid = "#ucenterHome";
            $(float_menu_id).prepend($("<li/>").attr({
                "id": uc_id.replace("#", "")
            }).html($("<a/>").attr({
                "id": hid.replace("#", "")
            })));
            if(data.user.id){
                var user_info = "";
                $.each(data.user.navs, function(key, nav) {
                    user_info += '<a href="' + nav.url + '" title="' + nav.text + '"><em>' + nav.text + "</em>";
                    if(nav.num){
                        user_info += '(' + nav.num + ')';
                    }
                    user_info += '</a>';
                });
                user_info += '<a class="logout_url" href="' + kernel.logoutUrl + '" title="退出登录">&laquo;退出登录</a>';
                $(hid).attr({
                    "title": data.user.username,
                    "href": data.user.homepage
                }).css({
                    "background-image": "url(" + kernel.htmlDecode(data.user.avatar) + ")"
                }).prepend('<div id="userInfoBox" class="floatBoxWrapper"><div class="floatBox"><a class="fn" href="' + data.user.homepage + '">' + data.user.username + "</a>" + user_info + "</div></div>");
            }else{
                $(hid).attr({
                    "title": data.user.welcome,
                    "href": kernel.loginUrl
                })
            }
        }
    };
    kernel.initPost = function(data){
        if(data.post){
            $("[data-num-views='true']").html(data.post.views);
            $("[data-num-comments='true']").html(data.post.comment_checked);
            $("#post-vote .up .num").html(data.post.praise_nums);
            $("#post-vote .updown .num").html(data.post.stamp_nums);
        }
        if(data.user.id){
            $('#login-tips').html(kernel.loginTips.yes.replace('{link}', data.user.homepage).replace('{username}', data.user.username));
        }else{
            $('#login-tips').html(kernel.loginTips.no);
        }
    };
    kernel.ready = function() {
        /*执行domready挂载函数*/
        $.each(kernel.readyCallbacks, function(i, callback){
            if(typeof callback == 'function'){
                callback.call(window);
            }else if(typeof kernel[callback] == 'function'){
                kernel[callback].call(window);
            }
        });
        if (window.location.hash.indexOf("#comment") === 0) {
            kernel.goHash("#comments")
        }
        kernel.readyAjax = $.ajax({
            type: "POST",
            url: kernel.pageInit.initUrl,
            data: kernel.pageInit.data,
            dataType: 'json',
            success: function(response){
                if(response.code == 0){
                    $.each(kernel.pageInit.callbacks, function(i, callback){
                        if(typeof callback == 'function'){
                            callback.call(window, response.info);
                        }else if(typeof kernel[callback] == 'function'){
                            kernel[callback].call(window, response.info);
                        }
                    });
                }
            }
        });
    };
    kernel.hideLookPopover = function() {
        var actionID = "#looks-image";
        if ($(actionID + ":hover").length <= 0) {
            $(actionID).popover("hide")
        }
        $document.off("click", "body", kernel.hideLookPopover)
    };
    kernel.codePrettify = function() {
        if (!kernel.cpfuri) {
            return
        }
        $(".entry-content code").each(function() {
            if ($(this).hasClass("prettyprint")) {
                return
            }
            if ($(this).parent("pre").length > 0 || $(this).parent(".prettyprint").length > 0) {
                return
            }
            if ($(this).data("linenums")) {
                $(this).wrap("<pre />").parent().addClass("prettyprint linenums")
            } else {
                $(this).addClass("prettyprint")
            }
        });
        if ($(".prettyprint").length > 0) {
            $.getScript(kernel.cpfuri,
            function() {
                prettyPrint()
            })
        }
    };
    $document.on("click", "[data-toggle=hash] a[href*=#]", function(e) {
        e.preventDefault();
        var st = kernel.hashOffset(this.hash);
        if (null !== st) {
            $("html,body").animate({
                scrollTop: st
            }, 800)
        }
    }).on("click", "#pagination-comments a", function() {
        if ($(kernel.commentsLoadID).length <= 0) {
            return
        }
        var url = $(this).attr("href");
        $(kernel.commentsThread).html($(kernel.commentsLoadID).removeClass("loaded").show());
        kernel.commentsLoad(paged);
        kernel.goHash("#thread-comments");
        return false
    }).on("submit", "#commentform", function() {
        var s = $("#commentsubmit"),
        c = $("#comment"),
        errorAlert = "#comment-error-alert";
        successTips = "#comment-success-tips";
        s.button("loading");
        $.ajax({
            type: "POST",
            url: $(this).attr("action"),
            data: $(this).serialize(),
            beforeSend: function() {
                c.prop("disabled", true)
            },
            success: function(response){
                if (response.code == 0) {
                    $(successTips).html(response.message).fadeIn(400, function() {
                        setTimeout(function() {
                            $(successTips).fadeOut()
                        }, 3000);
                    });
                } else {
                    $(errorAlert).html(response.message).fadeIn(400, function() {
                        setTimeout(function() {
                            $(errorAlert).fadeOut()
                        }, 3000);
                    });
                }
                s.button("reset");
                c.prop("disabled", false);
                history.pushState(null, "", kernel.pageUrl);
                kernel.lazyload()
            }
        });
        return false
    }).on("click", "#goTop", function(e) {
        if (e.target.id == $(this).attr("id") || $(e.target).parent().attr("id") == $(this).attr("id")) {
            $("html,body").animate({
                scrollTop: "0px"
            },
            800)
        }
    }).on("click", "#goBottom", function() {
        kernel.goHash("#colophon")
    }).on("click", "#goComments", function() {
        kernel.goHash("#comments")
    }).on("click", "#goVote", function() {
        kernel.goHash("#post-vote")
    }).on("click", "#refresh", function() {
        location.reload()
    }).on("click", ".vote-group a", function(e) {
        if ($(this).hasClass("disabled")) {
            return false;
        }
        var lastTime = kernel.voteTS ? kernel.voteTS: 0;
        if ((e.timeStamp - lastTime) < 1000) {
            return
        }
        kernel.voteTS = e.timeStamp;
        var parent = $(this).parent(),
        i = parent.attr("data-vote-id"),
        t = $.trim(parent.attr("data-vote-type")) == "post" ? "post": "comment",
        v = $(this).hasClass("up") ? "praise": "stamp";
        kernel.vote(t, i, v, $(this))
    }).on("click", ".article_index h5", function() {
        $(this).parent(".article_index").children("ul").toggle()
    }).on("click", "#set-font-small, #set-font-big", function() {
        $(this).addClass("disabled");
        $(this).siblings().removeClass("disabled");
        $("#content .entry-content").css($(this).attr("id") == "set-font-small" ? {
            "font-size": "initial"
        }: {
            "font-size": "larger"
        })
    }).on("click", "#looks-image", function() {
        if (!kernel.look || $("#comment").prop("disabled")) {
            return false
        }
        var html = '<ul id="looks-list" class="clearfix">';
        $.each(kernel.look.files,
        function(title, file) {
            html += '<li title="' + title + '"><img src="' + kernel.look.uri + file + '" alt="' + title + '" width="22" height="22" />'
        });
        html += "</ul>";
        if (typeof $(this).data("original-title") == "undefined") {
            $(this).popover({
                container: "#commentform",
                trigger: "manual",
                html: true,
                placement: "right",
                template: '<div class="popover look-popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content" id="looks"></div></div>',
                content: html
            })
        }
        $(this).popover("toggle");
        $document.on("click", "body", kernel.hideLookPopover)
    }).on("click", "#looks li", function() {
        var cid = "#comment",
        val = $(cid).val(),
        length = val.length,
        selectionStart = $(cid).prop("selectionStart"),
        look = "[" + $(this).attr("title") + "]",
        selectionRange = selectionStart + look.length;
        $(cid).val(val.slice(0, selectionStart) + look + val.slice(selectionStart, length)).focus();
        $(cid)[0].setSelectionRange(selectionRange, selectionRange);
        kernel.hideLookPopover();
        return false
    }).on("click", "#privacy-action", function() {
        if ($("#comment").prop("disabled")) {
            return false
        }
        var active = $(this).hasClass("active"),
        codeStart = "[pem]",
        codeEnd = "[/pem]",
        code = active ? codeEnd: codeStart,
        cid = "#comment",
        val = $(cid).val(),
        length = val.length,
        selectionStart = $(cid).prop("selectionStart"),
        selectionEnd = $(cid).prop("selectionEnd"),
        selectionRange = selectionStart,
        start = val.slice(selectionStart - codeStart.length, selectionStart) == codeStart,
        end = val.slice(selectionEnd, selectionEnd + codeEnd.length) == codeEnd,
        newVal = val;
        if (!start || !end) {
            if (selectionStart === selectionEnd) {
                if (selectionStart === length) {
                    newVal = val + codeStart + codeEnd;
                    selectionRange = selectionStart + codeStart.length
                } else {
                    newVal = val.slice(0, selectionStart) + code + val.slice(selectionStart, length);
                    $(this).button((active ? "reset": "endtag")).button("toggle");
                    selectionRange = selectionStart + code.length
                }
            } else {
                var c = val.slice(selectionStart, selectionEnd),
                c = c.replace(codeStart, "").replace(codeEnd, "");
                newVal = val.slice(0, selectionStart) + codeStart + c + codeEnd + val.slice(selectionEnd, length);
                selectionRange = selectionStart + c.length + codeStart.length + codeEnd.length
            }
        }
        $(cid).val(newVal).focus();
        $(cid)[0].setSelectionRange(selectionRange, selectionRange)
    }).ready(function() {
        kernel.ready();
        kernel.readied = true
    });
} (jQuery);
/*! 
 * dmeng pc (http://www.kernel.net) 
 * 7:58 2015/9/21
 * @author steven.chan.chihyu(http://duomeng.me)
 */
!
function($) {
    var $document = $(document),
    $window = $(window);
    kernel.floatNav = function() {
        var $main = $("#main"),
        $floatNav = $("#float-nav"),
        $menu = $floatNav.children("#float-nav-menu"),
        main_width = $main.width(),
        nav_width = $floatNav.width(),
        mtop = 0 - 50 - $menu.height() / 2;
        if ((main_width + nav_width * 2 + 20) > $window.width()) {
            $floatNav.css({
                "left": "auto",
                "right": "10px",
                "margin-top": mtop,
                "margin-left": 0
            })
        } else {
            $floatNav.css({
                "left": "50%",
                "right": "auto",
                "margin-top": mtop,
                "margin-left": main_width / 2 + 10
            })
        }
        $menu.fadeIn()
    };
    kernel.fixedLastAside = function(rs) {
        if (!kernel.readied) {
            return
        }
        var $masthead = $("#masthead"),
        $main = $("#main"),
        $content = $("#content"),
        $sidebar = $("#sidebar"),
        $e = $sidebar.children("aside").last();
        if ($e.length <= 0 || $content.height() <= $sidebar.height()) {
            return
        }
        var st = $window.scrollTop(),
        etop = parseInt($e.css("marginTop"));
        if (!$e.attr("data-offset-top") || $e.hasClass("static") || rs) {
            $e.attr("data-offset-top", $e.offset().top - etop).css("width", $sidebar.width())
        }
        var ot = $e.attr("data-offset-top"),
        et = ot - st,
        $nav = $masthead.children(".navbar"),
        t = $nav.outerHeight(),
        w = $window.width();
        if (w > 991) {
            var mot = $main.offset().top,
            eot = $main.outerHeight() + mot - $e.outerHeight(true),
            nh = $nav.outerHeight(true);
            if (et <= t && false === $e.hasClass("fixed")) {
                $e.removeClass("absolute static").addClass("fixed").css({
                    "top": t
                })
            }
            if ((st - etop) >= eot - nh && false === $e.hasClass("absolute")) {
                $e.removeClass("fixed static").addClass("absolute").css({
                    "top": eot - $masthead.outerHeight(true)
                })
            }
        }
        if ((w < 992 || et > t) && false === $e.hasClass("static")) {
            $e.removeClass("fixed absolute").addClass("static")
        }
    };
    kernel.fixedNavbar = function() {
        var $m = $("#masthead"),
        $h = $m.find(".header-content"),
        $n = $m.find(".navbar"),
        ht = $h.outerHeight(true),
        st = $window.scrollTop();
        $m.css("height", $n.outerHeight() + ht);
        if (st >= ht && $window.width() >= 768) {
            $n.removeClass("navbar-static-top").addClass("navbar-fixed-top")
        }
        if (st < ht) {
            $n.removeClass("navbar-fixed-top").addClass("navbar-static-top")
        }
    };
    kernel.scroll = function() {
        kernel.commentsLoad();
        kernel.fixedLastAside(0);
        kernel.fixedNavbar();
        var $goTop = $("#goTop");
        if ($window.scrollTop() > ($window.height() / 2)) {
            if ($goTop.is(":hidden")) {
                $goTop.fadeIn()
            }
        } else {
            if ($goTop.is(":visible")) {
                $goTop.fadeOut()
            }
        }
    };
    kernel.resize = function() {
        kernel.fixedLastAside(1);
        kernel.fixedNavbar();
        kernel.floatNav()
    };
    $document.on("mouseenter", "#pageShare", function() {
        var $qrcode = $("#shareQrcode");
        if (!$qrcode.attr("src")) {
            $qrcode.attr("src", $qrcode.data("api") + kernel.current_page_url)
        }
    }).on("click", "#sharePrompt", function(e) {
        prompt($(this).data("notice"), document.title + " " + location.href);
        return false
    }).on("mouseenter mouseleave", ".dropdown", function(e) {
        if ($window.width() > 767) {
            if (e.type == "mouseenter") {
                $(this).addClass("open")
            } else {
                $(this).removeClass("open")
            }
        }
    }).on("click", ".dropdown-toggle", function() {
        if ($(this).attr("href")) {
            window.location = $(this).attr("href")
        }
    }).ready(function() {
        kernel.fixedLastAside(1);
        kernel.fixedNavbar();
        kernel.readyAjax.done(function() {
            kernel.floatNav()
        })
    });
    $window.scroll(function() {
        kernel.scroll()
    }).resize(function() {
        kernel.resize()
    })
} (jQuery);